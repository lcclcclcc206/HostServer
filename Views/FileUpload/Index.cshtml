@using HostServer.Models;
@using ByteSizeLib;
@{
    ViewData["Title"] = "文件上传";
}

<div class="mb-5 mt-5">
    <h1>文件上传</h1>
    <a href="@HostConfiguration.UploadFileProvider!.RequestPath">上传文件目录</a><br />
    <div class="mt-3">
        <label for="path" class="form-label">路径：</label>
        <div class="input-group">
            <input type="text" class="form-control" readonly id="path" value="@HostConfiguration.UploadFileProvider!.RootPath">
            <button class="btn btn-primary" type="button" data-clipboard-text="@HostConfiguration.UploadFileProvider!.RootPath">复制</button>
        </div>
    </div>
    
</div>

<div class="mb-4">
    <h4>文件上传要求</h4>
    <ul>
        <li>一次能上传多个文件</li>
        <li>单次上传文件的大小限制为 @HostConfiguration.UploadFileProvider.FileSizeLimit.ToBinaryString()</li>
        <li>上传同名文件会覆盖原有文件</li>
    </ul>
</div>

<form enctype="multipart/form-data" method="post">
    <div class="mb-3">
        <label for="uploadFiles" class="form-label">选择上传的文件</label>
        <div class="input-group">
            <input name="uploadFiles" class="form-control" type="file" multiple id="uploadFiles" onchange="ChangeUploadFile()" />
            <button id="uploadButton" class="btn btn-primary" type="submit" asp-action="Index" disabled>开始上传</button>
        </div>
    </div>
</form>

@section Scripts{
    <script src="~/js/Validation.js"></script>
    <script src="~/js/Common.js"></script>
    <script>
        new ClipboardJS('.btn');
        let inputId = "uploadFiles";
        let buttonId = "uploadButton";
        ChangeUploadFile = () => {
            if (FileCountValidation(inputId) == false) {
                ChangeButtonState(buttonId, false);
                return;
            }
            if (FileSizeValidation(inputId, @HostConfiguration.UploadFileProvider.FileSizeLimit.Bytes) == false) {
                ChangeButtonState(buttonId, false);
                let fileSizeLimit = "@HostConfiguration.UploadFileProvider.FileSizeLimit.ToBinaryString()";
                alert(`File is too Big, please select a file less than ${fileSizeLimit}`);
                return;
            }
            ChangeButtonState(buttonId, true);
        }
        CopyPath = () => {
            navigator.clipboard.writeText('@HostConfiguration.UploadFileProvider!.RootPath!.Replace("\\","\\\\")');
        }
    </script>
}
